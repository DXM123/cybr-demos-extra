---
# Load policy into kubernetes branch
# This policy defines the demo branch kubernetes

- !policy
  id: applications
  owner: !group managers

# applications/cert is a layer that will aggregate permissions for all kubernetes applications that want to use k8s cert authn to consume Conjur secrets
- !layer
  id: applications/cert
  owner: !group managers

# Create the identity that we will use to authenticate to Conjur 
- !host
  id: followers/conjur-follower
  owner: !group managers
  annotations:
    authn-k8s/namespace: conjur-follower-cert
    authn-k8s/service-account: conjur-demo-acct
    authn-k8s/authentication-container-name: configurator

# Add the host we have created to the layer
- !grant
  roles:
    - !layer applications/cert
  members:
    - !host followers/conjur-follower

